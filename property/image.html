<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>图片优化——质量与性能的博弈 | nuonuo Blog</title>
    <meta name="description" content="个人笔记库">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.4d701dfb.css" as="style"><link rel="preload" href="/blog/assets/js/app.607c1ba4.js" as="script"><link rel="preload" href="/blog/assets/js/20.6cc05ee2.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.66ca43b4.js"><link rel="prefetch" href="/blog/assets/js/11.1bda51a4.js"><link rel="prefetch" href="/blog/assets/js/12.7e024983.js"><link rel="prefetch" href="/blog/assets/js/13.0fc94cd6.js"><link rel="prefetch" href="/blog/assets/js/14.68d7366c.js"><link rel="prefetch" href="/blog/assets/js/15.6e0a8222.js"><link rel="prefetch" href="/blog/assets/js/16.86171f67.js"><link rel="prefetch" href="/blog/assets/js/17.e8b36955.js"><link rel="prefetch" href="/blog/assets/js/18.151c5a75.js"><link rel="prefetch" href="/blog/assets/js/19.18e3fe39.js"><link rel="prefetch" href="/blog/assets/js/2.5ae90992.js"><link rel="prefetch" href="/blog/assets/js/21.4301888d.js"><link rel="prefetch" href="/blog/assets/js/22.0c9b437e.js"><link rel="prefetch" href="/blog/assets/js/23.714c19d9.js"><link rel="prefetch" href="/blog/assets/js/24.c1c693f3.js"><link rel="prefetch" href="/blog/assets/js/25.91953ca4.js"><link rel="prefetch" href="/blog/assets/js/26.b27a21d1.js"><link rel="prefetch" href="/blog/assets/js/3.c5474b01.js"><link rel="prefetch" href="/blog/assets/js/4.44cc47d8.js"><link rel="prefetch" href="/blog/assets/js/5.aad341a0.js"><link rel="prefetch" href="/blog/assets/js/6.6282afad.js"><link rel="prefetch" href="/blog/assets/js/7.810257e9.js"><link rel="prefetch" href="/blog/assets/js/8.c5be16c8.js"><link rel="prefetch" href="/blog/assets/js/9.78694199.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.4d701dfb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">nuonuo Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/utils/" class="nav-link">方法库</a></div><div class="nav-item"><a href="/blog/property/" class="nav-link router-link-active">性能优化</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">题目整理</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/utils/" class="nav-link">方法库</a></div><div class="nav-item"><a href="/blog/property/" class="nav-link router-link-active">性能优化</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">题目整理</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>前端性能优化</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/property/" class="sidebar-link">前端性能优化原理与实践</a></li><li><a href="/blog/property/EventLoop.html" class="sidebar-link">Event Loop 与异步更新策略</a></li><li><a href="/blog/property/throttle-debounce.html" class="sidebar-link">事件的节流（throttle）与防抖（debounce）</a></li><li><a href="/blog/property/Lazy-Load懒加载.html" class="sidebar-link">Lazy-Load懒加载</a></li><li><a href="/blog/property/image.html" class="active sidebar-link">图片优化——质量与性能的博弈</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/property/image.html#不同业务场景下的图片方案选型" class="sidebar-link">不同业务场景下的图片方案选型</a></li></ul></li><li><a href="/blog/property/webstorage.html" class="sidebar-link">本地存储——从 Cookie 到 Web Storage、IndexDB</a></li><li><a href="/blog/property/cache.html" class="sidebar-link">浏览器缓存机制介绍与缓存策略剖析</a></li><li><a href="/blog/property/CDN.html" class="sidebar-link">CDN</a></li><li><a href="/blog/property/SSR.html" class="sidebar-link">服务端渲染</a></li><li><a href="/blog/property/webpack-GZIP.html" class="sidebar-link">webpack性能调优与Gzip原理</a></li><li><a href="/blog/property/Performance.html" class="sidebar-link">Performance、LightHouse 与性能 API</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="图片优化——质量与性能的博弈"><a href="#图片优化——质量与性能的博弈" aria-hidden="true" class="header-anchor">#</a> 图片优化——质量与性能的博弈</h1> <h2 id="不同业务场景下的图片方案选型"><a href="#不同业务场景下的图片方案选型" aria-hidden="true" class="header-anchor">#</a> 不同业务场景下的图片方案选型</h2> <p>时下应用较为广泛的 Web 图片格式有 JPEG/JPG、PNG、WebP、Base64、SVG 等，这些格式都是很有故事的，值得我们好好研究一把。此外，老生常谈的雪碧图（CSS Sprites）</p> <h3 id="jpeg-jpg"><a href="#jpeg-jpg" aria-hidden="true" class="header-anchor">#</a> JPEG/JPG</h3> <p>关键字：<strong>有损压缩、体积小、加载快、不支持透明</strong></p> <h4 id="jpg-的优点"><a href="#jpg-的优点" aria-hidden="true" class="header-anchor">#</a> JPG 的优点</h4> <p>JPG 最大的特点是<strong>有损压缩</strong>。这种高效的压缩算法使它成为了一种非常轻巧的图片格式。另一方面，即使被称为“有损”压缩，JPG的压缩方式仍然是一种高质量的压缩方式：当我们把图片体积压缩至原有体积的 50% 以下时，JPG 仍然可以保持住 60% 的品质。此外，JPG 格式以 24 位存储单个图，可以呈现多达 1600 万种颜色，足以应对大多数场景下对色彩的要求，这一点决定了它压缩前后的质量损耗并不容易被我们人类的肉眼所察觉——前提是你用对了业务场景。</p> <h4 id="使用场景"><a href="#使用场景" aria-hidden="true" class="header-anchor">#</a> 使用场景</h4> <p>JPG 适用于呈现色彩丰富的图片，在我们日常开发中，JPG 图片经常作为大的背景图、轮播图或 Banner 图出现。</p> <h4 id="jpg-的缺陷"><a href="#jpg-的缺陷" aria-hidden="true" class="header-anchor">#</a> JPG 的缺陷</h4> <p>有损压缩在上文所展示的轮播图上确实很难露出马脚，但当它处理<strong>矢量图形</strong>和 <strong>Logo</strong> 等线条感较强、颜色对比强烈的图像时，人为压缩导致的图片模糊会相当明显。</p> <p>此外，JPEG 图像<strong>不支持透明度处理</strong>，透明图片需要召唤 PNG 来呈现。</p> <h3 id="png-8-与-png-24"><a href="#png-8-与-png-24" aria-hidden="true" class="header-anchor">#</a> PNG-8 与 PNG-24</h3> <p>关键字：<strong>无损压缩、质量高、体积大、支持透明</strong></p> <h4 id="png-的优点"><a href="#png-的优点" aria-hidden="true" class="header-anchor">#</a> PNG 的优点</h4> <p>PNG（可移植网络图形格式）是一种无损压缩的高保真的图片格式。8 和 24，这里都是二进制数的位数。按照我们前置知识里提到的对应关系，8 位的 PNG 最多支持 256 种颜色，而 24 位的可以呈现约 1600 万种颜色。</p> <p>PNG 图片具有比 JPG 更强的色彩表现力，对线条的处理更加细腻，对透明度有良好的支持。它弥补了上文我们提到的 JPG 的局限性，唯一的 BUG 就是<strong>体积太大</strong>。</p> <h4 id="png-8-与-png-24-的选择题"><a href="#png-8-与-png-24-的选择题" aria-hidden="true" class="header-anchor">#</a> PNG-8 与 PNG-24 的选择题</h4> <p>什么时候用 PNG-8，什么时候用 PNG-24，这是一个问题。</p> <p>理论上来说，当你追求最佳的显示效果、并且不在意文件体积大小时，是推荐使用 PNG-24 的。</p> <p>但实践当中，为了规避体积的问题，我们一般不用PNG去处理较复杂的图像。当我们遇到适合 PNG 的场景时，也会优先选择更为小巧的 PNG-8。</p> <p>如何确定一张图片是该用 PNG-8 还是 PNG-24 去呈现呢？好的做法是把图片先按照这两种格式分别输出，看 PNG-8 输出的结果是否会带来肉眼可见的质量损耗，并且确认这种损耗是否在我们（尤其是你的 UI 设计师）可接受的范围内，基于对比的结果去做判断。</p> <h4 id="应用场景"><a href="#应用场景" aria-hidden="true" class="header-anchor">#</a> 应用场景</h4> <p>前面我们提到，复杂的、色彩层次丰富的图片，用 PNG 来处理的话，成本会比较高，我们一般会交给 JPG 去存储。</p> <p>考虑到 PNG 在处理线条和颜色对比度方面的优势，我们主要用它来呈现小的 Logo、颜色简单且对比强烈的图片或背景等。</p> <p>此时我们再次把目光转向性能方面堪称业界楷模的淘宝首页，我们会发现它页面上的 Logo，无论大小，还真的都是 PNG 格式：</p> <h3 id="svg"><a href="#svg" aria-hidden="true" class="header-anchor">#</a> SVG</h3> <p>关键字：<strong>文本文件、体积小、不失真、兼容性好</strong></p> <p>SVG（可缩放矢量图形）是一种基于 XML 语法的图像格式。它和本文提及的其它图片种类有着本质的不同：SVG 对图像的处理不是基于像素点，而是是基于对图像的形状描述。</p> <h4 id="svg-的特性"><a href="#svg-的特性" aria-hidden="true" class="header-anchor">#</a> SVG 的特性</h4> <p>和性能关系最密切的一点就是：SVG 与 PNG 和 JPG 相比，<strong>文件体积更小，可压缩性更强</strong>。</p> <p>当然，作为矢量图，它最显著的优势还是在于<strong>图片可无限放大而不失真</strong>这一点上。这使得 SVG 即使是被放到视网膜屏幕上，也可以一如既往地展现出较好的成像品质——1 张 SVG 足以适配 n 种分辨率。</p> <p>此外，<strong>SVG 是文本文件</strong>。我们既可以像写代码一样定义 SVG，把它写在 HTML 里、成为 DOM 的一部分，也可以把对图形的描述写入以 .svg 为后缀的独立文件（SVG 文件在使用上与普通图片文件无异）。这使得 SVG 文件可以被非常多的工具读取和修改，具有较强的<strong>灵活性</strong>。</p> <p>SVG 的局限性主要有两个方面，一方面是它的渲染成本比较高，这点对性能来说是很不利的。另一方面，SVG 存在着其它图片格式所没有的学习成本（它是可编程的）。</p> <h4 id="svg-的使用方式与应用场景"><a href="#svg-的使用方式与应用场景" aria-hidden="true" class="header-anchor">#</a> SVG 的使用方式与应用场景</h4> <p>SVG 是文本文件，我们既可以像写代码一样定义 SVG，把它写在 HTML 里、成为 DOM 的一部分，也可以把对图形的描述写入以 .svg 为后缀的独立文件（SVG 文件在使用上与普通图片文件无异）。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2000/svg<span class="token punctuation">&quot;</span></span>   <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">cx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>50<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>50<span class="token punctuation">&quot;</span></span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>50<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>文件名.svg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="base64"><a href="#base64" aria-hidden="true" class="header-anchor">#</a> Base64</h3> <p>关键字：<strong>文本文件、依赖编码、小图标解决方案</strong></p> <p>Base64 并非一种图片格式，而是一种编码方式。Base64 和雪碧图一样，是作为小图标解决方案而存在的。在了解 Base64 之前，我们先来了解一下雪碧图。</p> <h4 id="前置知识：最经典的小图标解决方案——雪碧图（css-sprites）"><a href="#前置知识：最经典的小图标解决方案——雪碧图（css-sprites）" aria-hidden="true" class="header-anchor">#</a> 前置知识：最经典的小图标解决方案——雪碧图（CSS Sprites）</h4> <p>雪碧图、CSS 精灵、CSS Sprites、图像精灵，说的都是这个东西——一种将小图标和背景图像合并到一张图片上，然后利用 CSS 的背景定位来显示其中的每一部分的技术。</p> <p>和雪碧图一样，Base64 图片的出现，也是为了减少加载网页图片时对服务器的请求次数，从而提升网页性能。<strong>Base64 是作为雪碧图的补充而存在的。</strong></p> <h4 id="理解-base64"><a href="#理解-base64" aria-hidden="true" class="header-anchor">#</a> 理解 Base64</h4> <p>通过我们上文的演示，大家不难看出，每次加载图片，都是需要单独向服务器请求这个图片对应的资源的——这也就意味着一次 HTTP 请求的开销。</p> <p><strong>Base64 是一种用于传输 8Bit 字节码的编码方式，通过对图片进行 Base64 编码，我们可以直接将编码结果写入 HTML 或者写入 CSS，从而减少 HTTP 请求的次数。</strong></p> <h4 id="base64-的应用场景"><a href="#base64-的应用场景" aria-hidden="true" class="header-anchor">#</a> Base64 的应用场景</h4> <p>它对应的图片往往是<strong>非常小的 Logo</strong>。</p> <p>Base64 编码后，图片大小会膨胀为原文件的 4/3（这是由 Base64 的编码原理决定的）。如果我们把大图也编码到 HTML 或 CSS 文件中，后者的体积会明显增加，即便我们减少了 HTTP 请求，也无法弥补这庞大的体积带来的性能开销，得不偿失。
在传输非常小的图片的时候，Base64 带来的文件体积膨胀、以及浏览器解析 Base64 的时间开销，与它节省掉的 HTTP 请求开销相比，可以忽略不计，这时候才能真正体现出它在性能方面的优势。</p> <p>因此，Base64 并非万全之策，我们往往在一张图片满足以下条件时会对它应用 Base64 编码：</p> <ul><li>图片的实际尺寸很小（大家可以观察一下掘金页面的 Base64 图，几乎没有超过 2kb 的）</li> <li>图片无法以雪碧图的形式与其它小图结合（合成雪碧图仍是主要的减少 HTTP 请求的途径，Base64 是雪碧图的补充）</li> <li>图片的更新频率非常低（不需我们重复编码和修改文件内容，维护成本较低）</li></ul> <h4 id="base64-编码工具推荐"><a href="#base64-编码工具推荐" aria-hidden="true" class="header-anchor">#</a> Base64 编码工具推荐</h4> <p>这里最推荐的是利用 webpack 来进行 Base64 的编码——webpack 的 <a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fwebpack-contrib%2Furl-loader" target="_blank" rel="noopener noreferrer">url-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 非常聪明，它除了具备基本的 Base64 转码能力，还可以结合文件大小，帮我们判断图片是否有必要进行 Base64 编码。</p> <p>除此之外，市面上免费的 Base64 编解码工具种类是非常多样化的，有很多网站都提供在线编解码的服务，大家选取自己认为顺手的工具就好。</p> <h3 id="webp"><a href="#webp" aria-hidden="true" class="header-anchor">#</a> WebP</h3> <p>关键字：<strong>年轻的全能型选手</strong></p> <p>Google 专为 Web 开发的一种<strong>旨在加快图片加载速度</strong>的图片格式，它支持有损压缩和无损压缩。</p> <h4 id="webp-的优点"><a href="#webp-的优点" aria-hidden="true" class="header-anchor">#</a> WebP 的优点</h4> <p>WebP 像 JPEG 一样对细节丰富的图片信手拈来，像 PNG 一样支持透明，像 GIF 一样可以显示动态图片——它集多种图片文件格式的优点于一身。
WebP 的官方介绍对这一点有着更权威的阐述：</p> <p>与 PNG 相比，WebP 无损图像的尺寸缩小了 26％。在等效的 SSIM 质量指数下，WebP 有损图像比同类 JPEG 图像小 25-34％。 无损 WebP 支持透明度（也称为 alpha 通道），仅需 22％ 的额外字节。对于有损 RGB 压缩可接受的情况，有损 WebP 也支持透明度，与 PNG 相比，通常提供 3 倍的文件大小。</p> <h4 id="webp-的局限性-兼容性差"><a href="#webp-的局限性-兼容性差" aria-hidden="true" class="header-anchor">#</a> WebP 的局限性:兼容性差</h4> <p>此外，WebP 还会增加服务器的负担——和编码 JPG 文件相比，编码同样质量的 WebP 文件会占用更多的计算资源。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/property/Lazy-Load懒加载.html" class="prev">
          Lazy-Load懒加载
        </a></span> <span class="next"><a href="/blog/property/webstorage.html">
          本地存储——从 Cookie 到 Web Storage、IndexDB
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/20.6cc05ee2.js" defer></script><script src="/blog/assets/js/app.607c1ba4.js" defer></script>
  </body>
</html>
