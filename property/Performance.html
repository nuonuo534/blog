<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Performance、LightHouse 与性能 API | nuonuo Blog</title>
    <meta name="description" content="个人笔记库">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.4d701dfb.css" as="style"><link rel="preload" href="/blog/assets/js/app.607c1ba4.js" as="script"><link rel="preload" href="/blog/assets/js/16.86171f67.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.66ca43b4.js"><link rel="prefetch" href="/blog/assets/js/11.1bda51a4.js"><link rel="prefetch" href="/blog/assets/js/12.7e024983.js"><link rel="prefetch" href="/blog/assets/js/13.0fc94cd6.js"><link rel="prefetch" href="/blog/assets/js/14.68d7366c.js"><link rel="prefetch" href="/blog/assets/js/15.6e0a8222.js"><link rel="prefetch" href="/blog/assets/js/17.e8b36955.js"><link rel="prefetch" href="/blog/assets/js/18.151c5a75.js"><link rel="prefetch" href="/blog/assets/js/19.18e3fe39.js"><link rel="prefetch" href="/blog/assets/js/2.5ae90992.js"><link rel="prefetch" href="/blog/assets/js/20.6cc05ee2.js"><link rel="prefetch" href="/blog/assets/js/21.4301888d.js"><link rel="prefetch" href="/blog/assets/js/22.0c9b437e.js"><link rel="prefetch" href="/blog/assets/js/23.714c19d9.js"><link rel="prefetch" href="/blog/assets/js/24.c1c693f3.js"><link rel="prefetch" href="/blog/assets/js/25.91953ca4.js"><link rel="prefetch" href="/blog/assets/js/26.b27a21d1.js"><link rel="prefetch" href="/blog/assets/js/3.c5474b01.js"><link rel="prefetch" href="/blog/assets/js/4.44cc47d8.js"><link rel="prefetch" href="/blog/assets/js/5.aad341a0.js"><link rel="prefetch" href="/blog/assets/js/6.6282afad.js"><link rel="prefetch" href="/blog/assets/js/7.810257e9.js"><link rel="prefetch" href="/blog/assets/js/8.c5be16c8.js"><link rel="prefetch" href="/blog/assets/js/9.78694199.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.4d701dfb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">nuonuo Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/utils/" class="nav-link">方法库</a></div><div class="nav-item"><a href="/blog/property/" class="nav-link router-link-active">性能优化</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">题目整理</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/utils/" class="nav-link">方法库</a></div><div class="nav-item"><a href="/blog/property/" class="nav-link router-link-active">性能优化</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">题目整理</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>前端性能优化</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/property/" class="sidebar-link">前端性能优化原理与实践</a></li><li><a href="/blog/property/EventLoop.html" class="sidebar-link">Event Loop 与异步更新策略</a></li><li><a href="/blog/property/throttle-debounce.html" class="sidebar-link">事件的节流（throttle）与防抖（debounce）</a></li><li><a href="/blog/property/Lazy-Load懒加载.html" class="sidebar-link">Lazy-Load懒加载</a></li><li><a href="/blog/property/image.html" class="sidebar-link">图片优化——质量与性能的博弈</a></li><li><a href="/blog/property/webstorage.html" class="sidebar-link">本地存储——从 Cookie 到 Web Storage、IndexDB</a></li><li><a href="/blog/property/cache.html" class="sidebar-link">浏览器缓存机制介绍与缓存策略剖析</a></li><li><a href="/blog/property/CDN.html" class="sidebar-link">CDN</a></li><li><a href="/blog/property/SSR.html" class="sidebar-link">服务端渲染</a></li><li><a href="/blog/property/webpack-GZIP.html" class="sidebar-link">webpack性能调优与Gzip原理</a></li><li><a href="/blog/property/Performance.html" class="active sidebar-link">Performance、LightHouse 与性能 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/property/Performance.html#可视化监测：-performance面板" class="sidebar-link">可视化监测： Performance面板</a></li><li class="sidebar-sub-header"><a href="/blog/property/Performance.html#lighthouse" class="sidebar-link">LightHouse</a></li><li class="sidebar-sub-header"><a href="/blog/property/Performance.html#w3c-性能-api" class="sidebar-link">W3C 性能 API</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="performance、lighthouse-与性能-api"><a href="#performance、lighthouse-与性能-api" aria-hidden="true" class="header-anchor">#</a> Performance、LightHouse 与性能 API</h1> <p>性能监测方案主要有两种：<strong>可视化方案、可编程方案</strong>。</p> <h2 id="可视化监测：-performance面板"><a href="#可视化监测：-performance面板" aria-hidden="true" class="header-anchor">#</a> 可视化监测： Performance面板</h2> <h3 id="开始记录"><a href="#开始记录" aria-hidden="true" class="header-anchor">#</a> 开始记录</h3> <p>右键打开开发者工具，选中我们的 Performance 面板：</p> <p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664d6a13652f0db?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p> <p>当我们选中图中所标示的实心圆按钮，Performance 会开始帮我们记录我们后续的交互操作；当我们选中圆箭头按钮，Performance 会将页面重新加载，计算加载过程中的性能表现。 tips：使用 Performance 工具时，为了规避其它 Chrome 插件对页面的性能影响，我们最好在无痕模式下打开页面：</p> <h3 id="简要分析"><a href="#简要分析" aria-hidden="true" class="header-anchor">#</a> 简要分析</h3> <p>这里我打开掘金首页，选中 Performance 面板中的圆箭头，来看一下页面加载过程中的性能表现：</p> <p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664d714642f4dcb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p> <p>从上到下，依次为概述面板、详情面板。下我们先来观察一下概述面板，了解页面的基本表现：</p> <p>我们看右上角的三个栏目：FPS、CPU 和 NET。</p> <p><strong>FPS</strong>：这是一个和动画性能密切相关的指标，它表示每一秒的帧数。图中绿色柱状越高表示帧率越高，体验就越流畅。若出现红色块，则代表长时间帧，很可能会出现卡顿。图中以绿色为主，偶尔出现红块，说明网页性能并不糟糕，但仍有可优化的空间。</p> <p><strong>CPU</strong>：表示CPU的使用情况，不同的颜色片段代表着消耗CPU资源的不同事件类型。这部分的图像和下文详情面板中的Summary内容有对应关系，我们可以结合这两者挖掘性能瓶颈。</p> <p><strong>NET</strong>：粗略的展示了各请求的耗时与前后顺序。这个指标一般来说帮助不大。</p> <h3 id="挖掘性能瓶颈"><a href="#挖掘性能瓶颈" aria-hidden="true" class="header-anchor">#</a> 挖掘性能瓶颈</h3> <p>详情面板中的内容有很多。但一般来说，我们会主要去看 Main 栏目下的火焰图和 Summary 提供给我们的饼图——这两者和概述面板中的 CPU 一栏结合，可以帮我们迅速定位性能瓶颈（如下图）。</p> <p><img src="https://user-gold-cdn.xitu.io/2018/10/7/1664d9d24ee5bd4e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p> <p>先看 CPU 图表和 Summary 饼图。CPU 图表中，我们可以根据颜色填充的饱满程度，确定 CPU 的忙闲，进而了解该页面的总的任务量。而 Summary 饼图则以一种直观的方式告诉了我们，哪个类型的任务最耗时（从本例来看是脚本执行过程）。这样我们在优化的时候，就可以抓到“主要矛盾”，进而有的放矢地开展后续的工作了。</p> <p>再看 Main 提供给我们的火焰图。这个火焰图非常关键，它展示了整个运行时主进程所做的每一件事情（包括加载、脚本运行、渲染、布局、绘制等）。x 轴表示随时间的记录。每个长条就代表一个活动。更宽的条形意味着事件需要更长时间。y 轴表示调用堆栈，我们可以看到事件是相互堆叠的，上层的事件触发了下层的事件。</p> <p>CPU 图标和 Summary 图都是按照“类型”给我们提供性能信息，而 Main 火焰图则将粒度细化到了每一个函数的调用。到底是从哪个过程开始出问题、是哪个函数拖了后腿、又是哪个事件触发了这个函数，这些具体的、细致的问题都将在 Main 火焰图中得到解答。</p> <h2 id="lighthouse"><a href="#lighthouse" aria-hidden="true" class="header-anchor">#</a> LightHouse</h2> <p>Lighthouse 是一个开源的自动化工具，用于改进网络应用的质量。 你可以将其作为一个 Chrome 扩展程序运行，或从命令行运行。 为Lighthouse 提供一个需要审查的网址，它将针对此页面运行一连串的测试，然后生成一个有关页面性能的报告。</p> <p>分别是页面性能、PWA（渐进式 Web 应用）、可访问性（无障碍）、最佳实践、SEO 五项指标的跑分。孰强孰弱，我们一看便知。</p> <p>向下拉动 Report 页，我们还可以看到每一个指标的细化评估：</p> <p>在“Opportunities”中，LightHouse 甚至针对我们的性能问题给出了可行的建议、以及每一项优化操作预期会帮我们节省的时间。这份报告的可操作性是很强的——我们只需要对着 LightHouse 给出的建议，一条一条地去尝试，就可以看到自己的页面，在一秒一秒地变快。</p> <p>除了直接下载，我们还可以通过命令行使用 LightHouse：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm install <span class="token operator">-</span>g lighthouse
lighthouse https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>juejin<span class="token punctuation">.</span>im<span class="token operator">/</span>books
</code></pre></div><h2 id="w3c-性能-api"><a href="#w3c-性能-api" aria-hidden="true" class="header-anchor">#</a> W3C 性能 API</h2> <h3 id="访问-performance-对象"><a href="#访问-performance-对象" aria-hidden="true" class="header-anchor">#</a> 访问 performance 对象</h3> <p>performance 是一个全局对象。我们在控制台里输入 window.performance，就可一窥其全貌</p> <h3 id="关键时间节点"><a href="#关键时间节点" aria-hidden="true" class="header-anchor">#</a> 关键时间节点</h3> <p>在 performance 的 timing 属性中，可以查看到如下的时间戳</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/property/webpack-GZIP.html" class="prev">
          webpack性能调优与Gzip原理
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/16.86171f67.js" defer></script><script src="/blog/assets/js/app.607c1ba4.js" defer></script>
  </body>
</html>
