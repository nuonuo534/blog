<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端数据操作总结 | nuonuo Blog</title>
    <meta name="description" content="个人笔记库">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.4d701dfb.css" as="style"><link rel="preload" href="/blog/assets/js/app.607c1ba4.js" as="script"><link rel="preload" href="/blog/assets/js/25.91953ca4.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.66ca43b4.js"><link rel="prefetch" href="/blog/assets/js/11.1bda51a4.js"><link rel="prefetch" href="/blog/assets/js/12.7e024983.js"><link rel="prefetch" href="/blog/assets/js/13.0fc94cd6.js"><link rel="prefetch" href="/blog/assets/js/14.68d7366c.js"><link rel="prefetch" href="/blog/assets/js/15.6e0a8222.js"><link rel="prefetch" href="/blog/assets/js/16.86171f67.js"><link rel="prefetch" href="/blog/assets/js/17.e8b36955.js"><link rel="prefetch" href="/blog/assets/js/18.151c5a75.js"><link rel="prefetch" href="/blog/assets/js/19.18e3fe39.js"><link rel="prefetch" href="/blog/assets/js/2.5ae90992.js"><link rel="prefetch" href="/blog/assets/js/20.6cc05ee2.js"><link rel="prefetch" href="/blog/assets/js/21.4301888d.js"><link rel="prefetch" href="/blog/assets/js/22.0c9b437e.js"><link rel="prefetch" href="/blog/assets/js/23.714c19d9.js"><link rel="prefetch" href="/blog/assets/js/24.c1c693f3.js"><link rel="prefetch" href="/blog/assets/js/26.b27a21d1.js"><link rel="prefetch" href="/blog/assets/js/3.c5474b01.js"><link rel="prefetch" href="/blog/assets/js/4.44cc47d8.js"><link rel="prefetch" href="/blog/assets/js/5.aad341a0.js"><link rel="prefetch" href="/blog/assets/js/6.6282afad.js"><link rel="prefetch" href="/blog/assets/js/7.810257e9.js"><link rel="prefetch" href="/blog/assets/js/8.c5be16c8.js"><link rel="prefetch" href="/blog/assets/js/9.78694199.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.4d701dfb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">nuonuo Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/utils/" class="nav-link router-link-active">方法库</a></div><div class="nav-item"><a href="/blog/property/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">题目整理</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/utils/" class="nav-link router-link-active">方法库</a></div><div class="nav-item"><a href="/blog/property/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">题目整理</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>方法库</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/utils/" class="sidebar-link">代码块</a></li><li><a href="/blog/utils/dataControl.html" class="active sidebar-link">前端数据操作总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#src转img" class="sidebar-link">src转img</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#img转canvas" class="sidebar-link">img转canvas</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#imagedata转canvas" class="sidebar-link">ImageData转canvas</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#canvas转imagedata" class="sidebar-link">canvas转ImageData</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#canvas像素操作" class="sidebar-link">canvas像素操作</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#canava转dataurl-base64" class="sidebar-link">canava转DataURL(base64)</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#dataurl-base64-转blob" class="sidebar-link">DataURL(base64)转blob</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#file转arraybuffer" class="sidebar-link">file转arrayBuffer</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#file转blob" class="sidebar-link">file转blob</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#blob-arraybuffer-转file" class="sidebar-link">(blob,arraybuffer)转file</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#file-blob-转dataurl-base64" class="sidebar-link">file(blob)转DataURL(base64)</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#dataurl转file" class="sidebar-link">dataURL转File</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#blob转objecturl" class="sidebar-link">blob转objectURL</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#objecturl转img" class="sidebar-link">objectURL转img</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#objecturl-url-转blob" class="sidebar-link">objectURL(url)转blob</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#objecturl-url-转arraybuffer，当服务端传递二级制数据时使用" class="sidebar-link">objectURL(url)转arraybuffer，当服务端传递二级制数据时使用</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#formdata设置blob" class="sidebar-link">FormData设置blob</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#uint8clampedarray-uint8array-区别" class="sidebar-link">Uint8ClampedArray Uint8Array 区别</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#arraybuffer-视图-uint8array、float64array等-之slice" class="sidebar-link">arraybuffer,视图(Uint8Array、Float64Array等)之slice</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#数据" class="sidebar-link">数据</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#视图参数" class="sidebar-link">视图参数</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#视图对象dataview" class="sidebar-link">视图对象DataView</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#实现atob-string-转-base64-window-atob" class="sidebar-link">实现atob(string 转 base64) window.atob</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#实现btoa-base64-转-string-window-btoa" class="sidebar-link">实现btoa(base64 转 string) window.btoa</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#atob-btoa-不能编码解码中文" class="sidebar-link">atob,btoa 不能编码解码中文</a></li><li class="sidebar-sub-header"><a href="/blog/utils/dataControl.html#编码含义" class="sidebar-link">编码含义</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="前端数据操作总结"><a href="#前端数据操作总结" aria-hidden="true" class="header-anchor">#</a> 前端数据操作总结</h1> <h2 id="src转img"><a href="#src转img" aria-hidden="true" class="header-anchor">#</a> src转img</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">srctoimg</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>reslove<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">reslove</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> src
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="img转canvas"><a href="#img转canvas" aria-hidden="true" class="header-anchor">#</a> img转canvas</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">imgtocanvas</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> img<span class="token punctuation">.</span>width
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> img<span class="token punctuation">.</span>height
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> canvas
<span class="token punctuation">}</span>
</code></pre></div><h2 id="imagedata转canvas"><a href="#imagedata转canvas" aria-hidden="true" class="header-anchor">#</a> ImageData转canvas</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">ImageDatetocanvas</span><span class="token punctuation">(</span>imgData<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
 canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> imgData<span class="token punctuation">.</span>width
 canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> imgData<span class="token punctuation">.</span>height
 ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imgData<span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> canvas
<span class="token punctuation">}</span>
</code></pre></div><h2 id="canvas转imagedata"><a href="#canvas转imagedata" aria-hidden="true" class="header-anchor">#</a> canvas转ImageData</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">canvastoImageDate</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">createImageData</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="canvas像素操作"><a href="#canvas像素操作" aria-hidden="true" class="header-anchor">#</a> canvas像素操作</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">canvaspixel</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span>deal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> imgData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createImageData</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> imgData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">deal</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span>g<span class="token punctuation">,</span>b<span class="token punctuation">,</span>a<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imgData<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> canvas
<span class="token punctuation">}</span>
</code></pre></div><h2 id="canava转dataurl-base64"><a href="#canava转dataurl-base64" aria-hidden="true" class="header-anchor">#</a> canava转DataURL(base64)</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="dataurl-base64-转blob"><a href="#dataurl-base64-转blob" aria-hidden="true" class="header-anchor">#</a> DataURL(base64)转blob</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dataURLtoBlob</span><span class="token punctuation">(</span>dataurl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> arr <span class="token operator">=</span> dataurl<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mime <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/:(.*?);/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    bstr <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n <span class="token operator">=</span> bstr<span class="token punctuation">.</span>length<span class="token punctuation">,</span> u8arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    u8arr<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> bstr<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>u8arr<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> mime <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="file转arraybuffer"><a href="#file转arraybuffer" aria-hidden="true" class="header-anchor">#</a> file转arrayBuffer</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">filetoblob</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="file转blob"><a href="#file转blob" aria-hidden="true" class="header-anchor">#</a> file转blob</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">filetoblob</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span>file<span class="token punctuation">.</span>type<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="blob-arraybuffer-转file"><a href="#blob-arraybuffer-转file" aria-hidden="true" class="header-anchor">#</a> (blob,arraybuffer)转file</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">blobtofile</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>blob<span class="token punctuation">]</span><span class="token punctuation">,</span> name <span class="token punctuation">,</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span>blob<span class="token punctuation">.</span>type<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="file-blob-转dataurl-base64"><a href="#file-blob-转dataurl-base64" aria-hidden="true" class="header-anchor">#</a> file(blob)转DataURL(base64)</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">filetoblob</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="dataurl转file"><a href="#dataurl转file" aria-hidden="true" class="header-anchor">#</a> dataURL转File</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dataURLtoFile</span><span class="token punctuation">(</span>dataurl<span class="token punctuation">,</span> filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> arr <span class="token operator">=</span> dataurl<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mime <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/:(.*?);/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        bstr <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n <span class="token operator">=</span> bstr<span class="token punctuation">.</span>length<span class="token punctuation">,</span> u8arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        u8arr<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> bstr<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>u8arr<span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span>mime<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="blob转objecturl"><a href="#blob转objecturl" aria-hidden="true" class="header-anchor">#</a> blob转objectURL</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
</code></pre></div><h2 id="objecturl转img"><a href="#objecturl转img" aria-hidden="true" class="header-anchor">#</a> objectURL转img</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">srctoimg</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span>
</code></pre></div><h2 id="objecturl-url-转blob"><a href="#objecturl-url-转blob" aria-hidden="true" class="header-anchor">#</a> objectURL(url)转blob</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">URLtoblob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span>
      xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'blob'</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span>
      xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="objecturl-url-转arraybuffer，当服务端传递二级制数据时使用"><a href="#objecturl-url-转arraybuffer，当服务端传递二级制数据时使用" aria-hidden="true" class="header-anchor">#</a> objectURL(url)转arraybuffer，当服务端传递二级制数据时使用</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">URLtoblob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span>
      xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'arraybuffer'</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span>
      xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="formdata设置blob"><a href="#formdata设置blob" aria-hidden="true" class="header-anchor">#</a> FormData设置blob</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">appendBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">var</span> fd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 fd<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;image&quot;</span><span class="token punctuation">,</span> blob<span class="token punctuation">,</span> <span class="token string">&quot;image.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> fd
<span class="token punctuation">}</span>
</code></pre></div><h2 id="uint8clampedarray-uint8array-区别"><a href="#uint8clampedarray-uint8array-区别" aria-hidden="true" class="header-anchor">#</a> Uint8ClampedArray Uint8Array 区别</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Uint8ClampedArray 
 <span class="token number">1</span> <span class="token punctuation">,</span>它会将负数归入<span class="token number">0</span>，大于<span class="token number">255</span>的数归入<span class="token number">255</span>，所以取模就不用了。
 <span class="token number">2</span> <span class="token punctuation">,</span>小数取整
Uint8Array
 <span class="token number">1</span><span class="token punctuation">,</span><span class="token function">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 等价于 <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">233</span> <span class="token punctuation">]</span><span class="token punctuation">)</span> 
 <span class="token number">2</span><span class="token punctuation">,</span>四舍五入
在处理<span class="token number">0</span><span class="token operator">-</span><span class="token number">255</span>无区别
</code></pre></div><h2 id="arraybuffer-视图-uint8array、float64array等-之slice"><a href="#arraybuffer-视图-uint8array、float64array等-之slice" aria-hidden="true" class="header-anchor">#</a> arraybuffer,视图(Uint8Array、Float64Array等)之slice</h2> <p>buf返回buf 视图返回视图 1,分配内存 2，拷贝数据</p> <h2 id="数据"><a href="#数据" aria-hidden="true" class="header-anchor">#</a> 数据</h2> <p>1,new ArrayBuffer(40) 2,new Uint8Array( [ 1, 2, 3, 4 ] ) 3,Array.from(uint8Array);</p> <h2 id="视图参数"><a href="#视图参数" aria-hidden="true" class="header-anchor">#</a> 视图参数</h2> <p>var v3 = new Int16Array(buf, 2, 2); 第一个参数：视图对应的底层ArrayBuffer对象，该参数是必需的。 第二个参数：视图开始的字节序号，默认从0开始。 第三个参数：视图包含的数据个数，默认直到本段内存区域结束。</p> <p>视图.buffer 获取缓冲区</p> <h2 id="视图对象dataview"><a href="#视图对象dataview" aria-hidden="true" class="header-anchor">#</a> 视图对象DataView</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 从第1个字节读取一个8位无符号整数</span>
<span class="token keyword">var</span> v1 <span class="token operator">=</span> dv<span class="token punctuation">.</span><span class="token function">getUint8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 从第2个字节读取一个16位无符号整数</span>
<span class="token keyword">var</span> v2 <span class="token operator">=</span> dv<span class="token punctuation">.</span><span class="token function">getUint16</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 从第4个字节读取一个16位无符号整数</span>
<span class="token keyword">var</span> v3 <span class="token operator">=</span> dv<span class="token punctuation">.</span><span class="token function">getUint16</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

setInt8：写入<span class="token number">1</span>个字节的<span class="token number">8</span>位整数。
setUint8：写入<span class="token number">1</span>个字节的<span class="token number">8</span>位无符号整数。
setInt16：写入<span class="token number">2</span>个字节的<span class="token number">16</span>位整数。
setUint16：写入<span class="token number">2</span>个字节的<span class="token number">16</span>位无符号整数。
setInt32：写入<span class="token number">4</span>个字节的<span class="token number">32</span>位整数。
setUint32：写入<span class="token number">4</span>个字节的<span class="token number">32</span>位无符号整数。
setFloat32：写入<span class="token number">4</span>个字节的<span class="token number">32</span>位浮点数。
setFloat64：写入<span class="token number">8</span>个字节的<span class="token number">64</span>位浮点数。

<span class="token comment">// 在第1个字节，以大端字节序写入值为25的32位整数</span>
dv<span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 在第5个字节，以大端字节序写入值为25的32位整数</span>
dv<span class="token punctuation">.</span><span class="token function">setInt32</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 在第9个字节，以小端字节序写入值为2.5的32位浮点数</span>
dv<span class="token punctuation">.</span><span class="token function">setFloat32</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="实现atob-string-转-base64-window-atob"><a href="#实现atob-string-转-base64-window-atob" aria-hidden="true" class="header-anchor">#</a> 实现atob(string 转 base64) window.atob</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">_atob</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> base64hash <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span><span class="token punctuation">;</span>
  s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s|=/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> cur<span class="token punctuation">,</span>
    prev<span class="token punctuation">,</span>
    mod<span class="token punctuation">,</span>
    i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cur <span class="token operator">=</span> base64hash<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mod <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment">//TODO</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>prev <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">|</span> cur <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token operator">|</span> cur <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">|</span> cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    prev <span class="token operator">=</span> cur<span class="token punctuation">;</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="实现btoa-base64-转-string-window-btoa"><a href="#实现btoa-base64-转-string-window-btoa" aria-hidden="true" class="header-anchor">#</a> 实现btoa(base64 转 string) window.btoa</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">_btoa</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> base64hash <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/([^\u0000-\u00ff])/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'INVALID_CHARACTER_ERR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    prev<span class="token punctuation">,</span>
    ascii<span class="token punctuation">,</span>
    mod<span class="token punctuation">,</span>
    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ascii <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mod <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 第一个6位只需要让8位二进制右移两位</span>
      <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base64hash<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>ascii <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token comment">//第二个6位 = 第一个8位的后两位 + 第二个8位的前4位</span>
      <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base64hash<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token punctuation">(</span>ascii <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token comment">//第三个6位 = 第二个8位的后4位 + 第三个8位的前2位</span>
      <span class="token comment">//第4个6位 = 第三个8位的后6位</span>
      <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base64hash<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token punctuation">(</span>ascii <span class="token operator">&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base64hash<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>ascii <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    prev <span class="token operator">=</span> ascii<span class="token punctuation">;</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 循环结束后看mod, 为0 证明需补3个6位，第一个为最后一个8位的最后两位后面补4个0。另外两个6位对应的是异常的“=”；</span>
  <span class="token comment">// mod为1，证明还需补两个6位，一个是最后一个8位的后4位补两个0，另一个对应异常的“=”</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mod <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base64hash<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'=='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mod <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>base64hash<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="atob-btoa-不能编码解码中文"><a href="#atob-btoa-不能编码解码中文" aria-hidden="true" class="header-anchor">#</a> atob,btoa 不能编码解码中文</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">&quot;China，中国&quot;</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">btoa</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//&quot;Q2hpbmElRUYlQkMlOEMlRTQlQjglQUQlRTUlOUIlQkQ=&quot;</span>
window<span class="token punctuation">.</span><span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span><span class="token string">'Q2hpbmElRUYlQkMlOEMlRTQlQjglQUQlRTUlOUIlQkQ='</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//&quot;China，中国&quot;</span>
</code></pre></div><h2 id="编码含义"><a href="#编码含义" aria-hidden="true" class="header-anchor">#</a> 编码含义</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1</span>，区分数据部分和参数部分
<span class="token number">2</span><span class="token function">，解决中文乱码</span><span class="token punctuation">(</span>服务端和客户端编码不一致<span class="token punctuation">)</span>

escape不编码字符有<span class="token number">69</span>个：<span class="token operator">*</span>，<span class="token operator">+</span>，<span class="token operator">-</span>，<span class="token punctuation">.</span>，<span class="token operator">/</span>，@，_，<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>，a<span class="token operator">-</span>z，<span class="token constant">A</span><span class="token operator">-</span><span class="token constant">Z</span>
encodeURI不编码字符有<span class="token number">82</span>个：<span class="token operator">!</span>，#，$，<span class="token operator">&amp;</span>，'<span class="token function">，</span><span class="token punctuation">(</span>，<span class="token punctuation">)</span>，<span class="token operator">*</span>，<span class="token operator">+</span>，<span class="token punctuation">,</span>，<span class="token operator">-</span>，<span class="token punctuation">.</span>，<span class="token operator">/</span>，<span class="token punctuation">:</span>，<span class="token punctuation">;</span>，<span class="token operator">=</span>，<span class="token operator">?</span>，@，_，<span class="token operator">~</span>，<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>，a<span class="token operator">-</span>z，<span class="token constant">A</span><span class="token operator">-</span><span class="token constant">Z</span>
encodeURIComponent不编码字符有<span class="token number">71</span>个：<span class="token operator">!</span>， '<span class="token function">，</span><span class="token punctuation">(</span>，<span class="token punctuation">)</span>，<span class="token operator">*</span>，<span class="token operator">-</span>，<span class="token punctuation">.</span>，_，<span class="token operator">~</span>，<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>，a<span class="token operator">-</span>z，<span class="token constant">A</span><span class="token operator">-</span><span class="token constant">Z</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/utils/" class="prev router-link-active">
          代码块
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/25.91953ca4.js" defer></script><script src="/blog/assets/js/app.607c1ba4.js" defer></script>
  </body>
</html>
